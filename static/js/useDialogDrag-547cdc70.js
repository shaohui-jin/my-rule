import{q as X,m as L}from"./index-1b7a9618.js";const I=(Y={})=>{const{handle:d=null,boundary:$=!0,onStart:f=null,onMove:v=null,onEnd:y=null,onInitialized:w=null,autoInit:C=!1,boundaryType:R="mask",retry:B={}}=Y,{count:M=5,delay:S=50}=B,c=L(!1),m=L(!1),i=L("等待初始化"),l={startX:0,startY:0,offsetX:0,offsetY:0,header:null,dialog:null,mask:null,wrapper:null,cleanup:null},b=()=>{const e=[".el-overlay .el-overlay-dialog .el-dialog",".el-overlay-dialog .el-dialog",".el-dialog-wrapper .el-dialog",".el-dialog__wrapper .el-dialog",".el-dialog"];for(const o of e){const n=document.querySelectorAll(o);if(n.length>0){const t=n[n.length-1],a=t.closest(".el-overlay-dialog")||t.closest(".el-overlay")||t.closest(".el-dialog-wrapper")||t.closest(".el-dialog__wrapper")||t.parentElement,s=t.querySelector(".el-dialog__header"),r=t.closest(".el-overlay");if(s)return{wrapper:a,dialog:t,header:s,mask:r}}}return null},_=async(e=M)=>{for(let o=1;o<=e;o++)try{i.value=`正在初始化... (尝试 ${o}/${e})`,await X();const n=b();if(!n)throw new Error("未找到对话框元素");const{wrapper:t,header:a,dialog:s,mask:r}=n,g=window.getComputedStyle(s);if(g.display==="none"||g.visibility==="hidden")throw new Error("对话框不可见");Object.assign(l,{header:a,dialog:s,wrapper:t,mask:r,cleanup:null});const u=q();return l.cleanup=u,m.value=!0,i.value="拖拽功能已就绪",w==null||w({element:s,header:a,mask:r}),!0}catch(n){if(console.warn(`初始化尝试 ${o} 失败:`,n.message),o===e)return i.value=`初始化失败: ${n.message}`,!1;await new Promise(t=>setTimeout(t,S))}return!1},h=async()=>(x(),i.value="开始初始化拖拽功能...",await _()),q=()=>{const{header:e,dialog:o}=l;if(!e||!o)throw new Error("对话框元素未就绪");k(o);const n=d?e.querySelector(d):e;if(!n)throw new Error(`未找到拖拽手柄: ${d}`);n.style.cursor="move",n.style.userSelect="none";const t=s=>{d&&!s.target.closest(d)||T(s)},a=()=>k(o);return n.addEventListener("mousedown",t),window.addEventListener("resize",a),()=>{n.removeEventListener("mousedown",t),window.removeEventListener("resize",a)}},k=e=>{if(!e)return;const n=(R==="mask"&&l.mask?l.mask:document.documentElement).getBoundingClientRect(),t=e.getBoundingClientRect();e.style.position="absolute",e.style.left=`${(n.width-t.width)/2}px`,e.style.top=`${(n.height-t.height)/2}px`,e.style.margin="0"},T=e=>{c.value=!0;const{dialog:o,header:n}=l,t=o.getBoundingClientRect();l.startX=e.clientX,l.startY=e.clientY,l.offsetX=e.clientX-t.left,l.offsetY=e.clientY-t.top,n.classList.add("dragging"),i.value="拖拽中...",o.style.transition="none",f==null||f({x:t.left,y:t.top,element:o});const a=r=>E(r),s=()=>D();document.addEventListener("mousemove",a),document.addEventListener("mouseup",s),e.preventDefault()},E=e=>{if(!c.value)return;const{dialog:o,offsetX:n,offsetY:t,mask:a}=l,r=(R==="mask"&&a?a:document.documentElement).getBoundingClientRect(),g=o.getBoundingClientRect();let u=e.clientX-r.left-n,p=e.clientY-r.top-t;$&&(u=Math.max(0,Math.min(u,r.width-g.width)),p=Math.max(0,Math.min(p,r.height-g.height))),o.style.left=`${u}px`,o.style.top=`${p}px`,v==null||v({x:u,y:p,element:o})},D=()=>{if(!c.value)return;c.value=!1,l.header.classList.remove("dragging"),l.dialog.style.transition="";const e=l.dialog.getBoundingClientRect();i.value="拖拽结束",y==null||y({x:e.left,y:e.top,element:l.dialog}),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",D)},z=async()=>(m.value=!1,await h()),x=()=>{l.cleanup&&(l.cleanup(),l.cleanup=null),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",D),m.value=!1,c.value=!1,i.value="已销毁",Object.assign(l,{header:null,dialog:null,mask:null,wrapper:null,cleanup:null})};return C&&X(()=>{setTimeout(()=>{h()},100)}),{isDragging:c,isInitialized:m,dragStatus:i,initDialog:h,reinit:z,destroy:x}};export{I as u};
